<p>åœ¨è‚¡ç¥¨äº¤æ˜“ä¸­ï¼Œå¦‚æœå‰ä¸€å¤©çš„è‚¡ä»·é«˜äºåä¸€å¤©çš„è‚¡ä»·ï¼Œåˆ™å¯ä»¥è®¤ä¸ºå­˜åœ¨ä¸€ä¸ªã€Œäº¤æ˜“é€†åºå¯¹ã€ã€‚è¯·è®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œè¾“å…¥ä¸€æ®µæ—¶é—´å†…çš„è‚¡ç¥¨äº¤æ˜“è®°å½• <code>record</code>ï¼Œè¿”å›å…¶ä¸­å­˜åœ¨çš„ã€Œäº¤æ˜“é€†åºå¯¹ã€æ€»æ•°ã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1:</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>record = [9, 7, 5, 4, 6]
<strong>è¾“å‡ºï¼š</strong>8
<strong>è§£é‡Šï¼š</strong>äº¤æ˜“ä¸­çš„é€†åºå¯¹ä¸º (9, 7), (9, 5), (9, 4), (9, 6), (7, 5), (7, 4), (7, 6), (5, 4)ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>é™åˆ¶ï¼š</strong></p>

<p><code>0 &lt;= record.length &lt;= 50000</code></p>

<details><summary><strong>Related Topics</strong></summary>æ ‘çŠ¶æ•°ç»„ | çº¿æ®µæ ‘ | æ•°ç»„ | äºŒåˆ†æŸ¥æ‰¾ | åˆ†æ²» | æœ‰åºé›†åˆ | å½’å¹¶æ’åº</details><br>

<div>ğŸ‘ 1070, ğŸ‘ 0<span style='float: right;'><span style='color: gray;'><a href='https://github.com/labuladong/fucking-algorithm/discussions/939' target='_blank' style='color: lightgray;text-decoration: underline;'>bug åé¦ˆ</a> | <a href='https://labuladong.gitee.io/article/fname.html?fname=jbæ’ä»¶ç®€ä»‹' target='_blank' style='color: lightgray;text-decoration: underline;'>ä½¿ç”¨æŒ‡å—</a> | <a href='https://labuladong.github.io/algo/images/others/%E5%85%A8%E5%AE%B6%E6%A1%B6.jpg' target='_blank' style='color: lightgray;text-decoration: underline;'>æ›´å¤šé…å¥—æ’ä»¶</a></span></span></div>

<div id="labuladong"><hr>

**é€šçŸ¥ï¼š[æ•°æ®ç»“æ„ç²¾å“è¯¾](https://aep.h5.xeknow.com/s/1XJHEO) å’Œ [é€’å½’ç®—æ³•ä¸“é¢˜è¯¾](https://aep.xet.tech/s/3YGcq3) é™æ—¶é™„èµ ç½‘ç«™ä¼šå‘˜ï¼Œå…¨æ–°çº¸è´¨ä¹¦[ã€Šlabuladong çš„ç®—æ³•ç¬”è®°ã€‹](https://labuladong.gitee.io/algo/images/book/book_intro_qrcode.jpg) å‡ºç‰ˆï¼Œç­¾åç‰ˆé™æ—¶åŠä»·ï¼**

<details><summary><strong>labuladong æ€è·¯</strong></summary>

## åŸºæœ¬æ€è·¯

è¿™é“é¢˜å’Œ [å½’å¹¶æ’åºè¯¦è§£åŠè¿ç”¨](https://labuladong.github.io/article/fname.html?fname=å½’å¹¶æ’åº) ä¸­è®²çš„ [493. ç¿»è½¬å¯¹](/problems/reverse-pairs/) åŸºæœ¬ç›¸åŒï¼Œåªè¦æŠŠ 493 é¢˜è§£æ³•ä¸­çš„ `nums[end] * 2` æ”¹æˆ `nums[end]` å³å¯ã€‚

**æ ‡ç­¾ï¼šå½’å¹¶æ’åº**

## è§£æ³•ä»£ç 

æç¤ºï¼šğŸŸ¢ æ ‡è®°çš„æ˜¯æˆ‘å†™çš„è§£æ³•ä»£ç ï¼ŒğŸ¤– æ ‡è®°çš„æ˜¯ chatGPT ç¿»è¯‘çš„å¤šè¯­è¨€è§£æ³•ä»£ç ã€‚å¦‚æœ‰é”™è¯¯ï¼Œå¯ä»¥ [ç‚¹è¿™é‡Œ](https://github.com/labuladong/fucking-algorithm/issues/1113) åé¦ˆå’Œä¿®æ­£ã€‚

<div class="tab-panel"><div class="tab-nav">
<button data-tab-item="cpp" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">cppğŸ¤–</button>

<button data-tab-item="python" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">pythonğŸ¤–</button>

<button data-tab-item="java" class="tab-nav-button btn active" data-tab-group="default" onclick="switchTab(this)">javağŸŸ¢</button>

<button data-tab-item="go" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">goğŸ¤–</button>

<button data-tab-item="javascript" class="tab-nav-button btn " data-tab-group="default" onclick="switchTab(this)">javascriptğŸ¤–</button>
</div><div class="tab-content">
<div data-tab-item="cpp" class="tab-item " data-tab-group="default"><div class="highlight">

```cpp
// æ³¨æ„ï¼šcpp ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

class Solution {
public:
    int reversePairs(vector<int>& nums) {
        if (nums.size() == 0) {
            return 0;
        }
        // æ‰§è¡Œå½’å¹¶æ’åº
        sort(nums);
        return count;
    }

    void sort(vector<int>& nums) {
        temp.resize(nums.size());
        sort(nums, 0, nums.size() - 1);
    }

    // å½’å¹¶æ’åº
    void sort(vector<int>& nums, int lo, int hi) {
        if (lo == hi) {
            return;
        }
        int mid = lo + (hi - lo) / 2;
        sort(nums, lo, mid);
        sort(nums, mid + 1, hi);
        merge(nums, lo, mid, hi);
    }

    // è®°å½•ã€Œç¿»è½¬å¯¹ã€çš„ä¸ªæ•°
    int count = 0;

    void merge(vector<int>& nums, int lo, int mid, int hi) {
        for (int i = lo; i <= hi; i++) {
            temp[i] = nums[i];
        }

        // è¿›è¡Œæ•ˆç‡ä¼˜åŒ–ï¼Œç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [mid+1, end) ä¸­çš„å…ƒç´ ä¹˜ 2 å°äº nums[i]
        // ä¸ºä»€ä¹ˆ end æ˜¯å¼€åŒºé—´ï¼Ÿå› ä¸ºè¿™æ ·çš„è¯å¯ä»¥ä¿è¯åˆå§‹åŒºé—´ [mid+1, mid+1) æ˜¯ä¸€ä¸ªç©ºåŒºé—´
        int end = mid + 1;
        for (int i = lo; i <= mid; i++) {
            // nums ä¸­çš„å…ƒç´ å¯èƒ½è¾ƒå¤§ï¼Œä¹˜ 2 å¯èƒ½æº¢å‡ºï¼Œæ‰€ä»¥è½¬åŒ–æˆ long
            while (end <= hi && nums[i] > nums[end]) {
                end++;
            }
            count += end - (mid + 1);
        }

        // æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
        int i = lo, j = mid + 1;
        for (int p = lo; p <= hi; p++) {
            if (i == mid + 1) {
                nums[p] = temp[j++];
            } else if (j == hi + 1) {
                nums[p] = temp[i++];
            } else if (temp[i] > temp[j]) {
                nums[p] = temp[j++];
            } else {
                nums[p] = temp[i++];
            }
        }
    }

private:
    vector<int> temp;
};
```

</div></div>

<div data-tab-item="python" class="tab-item " data-tab-group="default"><div class="highlight">

```python
# æ³¨æ„ï¼špython ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
# æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

class Solution:
    def __init__(self):
        self.count = 0
        self.tmp = []

    # åŒ…è£…æ–¹æ³•
    def reversePairs(self, nums: List[int]) -> int:
        if not nums:
            return 0
        # æ‰§è¡Œå½’å¹¶æ’åº
        self.ms(nums, 0, len(nums) - 1)
        return self.count

    # å½’å¹¶æ’åº
    def ms(self, nums, left, right):
        if left >= right:
            return
        mid = (left + right) >> 1
        self.ms(nums, left, mid)
        self.ms(nums, mid + 1, right)
        self.merge(nums, left, mid, right)

    # åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    def merge(self, nums, left, mid, right):
        i, j = left, mid + 1
        t = []
        # è¿›è¡Œæ•ˆç‡ä¼˜åŒ–ï¼Œç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [mid+1, end) ä¸­çš„å…ƒç´ ä¹˜ 2 å°äº nums[i]
        # ä¸ºä»€ä¹ˆ end æ˜¯å¼€åŒºé—´ï¼Ÿå› ä¸ºè¿™æ ·çš„è¯å¯ä»¥ä¿è¯åˆå§‹åŒºé—´ [mid+1, mid+1) æ˜¯ä¸€ä¸ªç©ºåŒºé—´
        end = mid + 1
        while i <= mid and j <= right:
            if nums[i] <= nums[j]:
                t.append(nums[i])
                i += 1
            else:
                t.append(nums[j])
                j += 1
                self.count += (mid - i + 1)

        while i <= mid:
            t.append(nums[i])
            i += 1

        while j <= right:
            t.append(nums[j])
            j += 1

        nums[left:right + 1] = t
```

</div></div>

<div data-tab-item="java" class="tab-item active" data-tab-group="default"><div class="highlight">

```java
class Solution {
    public int reversePairs(int[] nums) {
        if (nums.length == 0) {
            return 0;
        }
        // æ‰§è¡Œå½’å¹¶æ’åº
        sort(nums);
        return count;
    }

    private int[] temp;

    public void sort(int[] nums) {
        temp = new int[nums.length];
        sort(nums, 0, nums.length - 1);
    }

    // å½’å¹¶æ’åº
    private void sort(int[] nums, int lo, int hi) {
        if (lo == hi) {
            return;
        }
        int mid = lo + (hi - lo) / 2;
        sort(nums, lo, mid);
        sort(nums, mid + 1, hi);
        merge(nums, lo, mid, hi);
    }

    // è®°å½•ã€Œç¿»è½¬å¯¹ã€çš„ä¸ªæ•°
    private int count = 0;

    private void merge(int[] nums, int lo, int mid, int hi) {
        for (int i = lo; i <= hi; i++) {
            temp[i] = nums[i];
        }

        // è¿›è¡Œæ•ˆç‡ä¼˜åŒ–ï¼Œç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [mid+1, end) ä¸­çš„å…ƒç´ ä¹˜ 2 å°äº nums[i]
        // ä¸ºä»€ä¹ˆ end æ˜¯å¼€åŒºé—´ï¼Ÿå› ä¸ºè¿™æ ·çš„è¯å¯ä»¥ä¿è¯åˆå§‹åŒºé—´ [mid+1, mid+1) æ˜¯ä¸€ä¸ªç©ºåŒºé—´
        int end = mid + 1;
        for (int i = lo; i <= mid; i++) {
            // nums ä¸­çš„å…ƒç´ å¯èƒ½è¾ƒå¤§ï¼Œä¹˜ 2 å¯èƒ½æº¢å‡ºï¼Œæ‰€ä»¥è½¬åŒ–æˆ long
            while (end <= hi && nums[i] > nums[end]) {
                end++;
            }
            count += end - (mid + 1);
        }

        // æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
        int i = lo, j = mid + 1;
        for (int p = lo; p <= hi; p++) {
            if (i == mid + 1) {
                nums[p] = temp[j++];
            } else if (j == hi + 1) {
                nums[p] = temp[i++];
            } else if (temp[i] > temp[j]) {
                nums[p] = temp[j++];
            } else {
                nums[p] = temp[i++];
            }
        }
    }
}
```

</div></div>

<div data-tab-item="go" class="tab-item " data-tab-group="default"><div class="highlight">

```go
// æ³¨æ„ï¼šgo ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç å·²ç»é€šè¿‡åŠ›æ‰£çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåº”è¯¥å¯ç›´æ¥æˆåŠŸæäº¤ã€‚

func reversePairs(nums []int) int {
    if len(nums) == 0 {
        return 0
    }
    // æ‰§è¡Œå½’å¹¶æ’åºå¹¶ç»Ÿè®¡ã€Œç¿»è½¬å¯¹ã€çš„ä¸ªæ•°
    return sort(nums)
}

func sort(nums []int) int {
    var temp = make([]int, len(nums))
    var count = 0 // ç»Ÿè®¡ç¿»è½¬å¯¹ä¸ªæ•°
    sortHelper(nums, 0, len(nums) - 1, temp, &count)
    return count
}

// å½’å¹¶æ’åº
func sortHelper(nums []int, lo, hi int, temp []int, count *int) {
    if lo == hi {
        return
    }
    mid := lo + (hi - lo) / 2
    sortHelper(nums, lo, mid, temp, count)
    sortHelper(nums, mid + 1, hi, temp, count)
    merge(nums, lo, mid, hi, temp, count)
}

func merge(nums []int, lo, mid, hi int, temp []int, count *int) {
    // å…ˆå°† nums ä¸­ [lo, hi] çš„æ•°å¤åˆ¶åˆ° temp ä¸­
    for i := lo; i <= hi; i++ {
        temp[i] = nums[i]
    }

    // è¿›è¡Œæ•ˆç‡ä¼˜åŒ–ï¼Œç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [mid+1, end) ä¸­çš„å…ƒç´ ä¹˜ 2 å°äº nums[i]
    // ä¸ºä»€ä¹ˆ end æ˜¯å¼€åŒºé—´ï¼Ÿå› ä¸ºè¿™æ ·çš„è¯å¯ä»¥ä¿è¯åˆå§‹åŒºé—´ [mid+1, mid+1) æ˜¯ä¸€ä¸ªç©ºåŒºé—´
    end := mid + 1
    for i := lo; i <= mid; i++ {
        // nums ä¸­çš„å…ƒç´ å¯èƒ½è¾ƒå¤§ï¼Œä¹˜ 2 å¯èƒ½æº¢å‡ºï¼Œæ‰€ä»¥è½¬åŒ–æˆ int64
        for end <= hi && int64(nums[i]) > int64(nums[end]) * 2 {
            end++
        }
        *count += end - (mid + 1)
    }

    // æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    i, j := lo, mid + 1
    for p := lo; p <= hi; p++ {
        if i == mid + 1 {
            nums[p] = temp[j]
            j++
        } else if j == hi + 1 {
            nums[p] = temp[i]
            i++
        } else if temp[i] > temp[j] {
            nums[p] = temp[j]
            j++
        } else {
            nums[p] = temp[i]
            i++
        }
    }
}
```

</div></div>

<div data-tab-item="javascript" class="tab-item " data-tab-group="default"><div class="highlight">

```javascript
// æ³¨æ„ï¼šjavascript ä»£ç ç”± chatGPTğŸ¤– æ ¹æ®æˆ‘çš„ java ä»£ç ç¿»è¯‘ï¼Œæ—¨åœ¨å¸®åŠ©ä¸åŒèƒŒæ™¯çš„è¯»è€…ç†è§£ç®—æ³•é€»è¾‘ã€‚
// æœ¬ä»£ç ä¸ä¿è¯æ­£ç¡®æ€§ï¼Œä»…ä¾›å‚è€ƒã€‚å¦‚æœ‰ç–‘æƒ‘ï¼Œå¯ä»¥å‚ç…§æˆ‘å†™çš„ java ä»£ç å¯¹æ¯”æŸ¥çœ‹ã€‚

var reversePairs = function(nums) {
    if (nums.length == 0) {
        return 0;
    }
    // æ‰§è¡Œå½’å¹¶æ’åº
    sort(nums);
    return count;
};

function sort(nums) {
    var temp = new Array(nums.length);
    var count = new Array(1);
    sortUtil(nums, 0, nums.length - 1, temp, count);
}

// å½’å¹¶æ’åº
function sortUtil(nums, lo, hi, temp, count) {
    if (lo == hi) {
        return;
    }
    var mid = parseInt(lo + (hi - lo) / 2);
    sortUtil(nums, lo, mid, temp, count);
    sortUtil(nums, mid + 1, hi, temp, count);
    merge(nums, lo, mid, hi, temp, count);
}

// è®°å½•ã€Œç¿»è½¬å¯¹ã€çš„ä¸ªæ•°
function merge(nums, lo, mid, hi, temp, count) {
    for (var i = lo; i <= hi; i++) {
        temp[i] = nums[i];
    }

    // è¿›è¡Œæ•ˆç‡ä¼˜åŒ–ï¼Œç»´æŠ¤å·¦é—­å³å¼€åŒºé—´ [mid+1, end) ä¸­çš„å…ƒç´ ä¹˜ 2 å°äº nums[i]
    // ä¸ºä»€ä¹ˆ end æ˜¯å¼€åŒºé—´ï¼Ÿå› ä¸ºè¿™æ ·çš„è¯å¯ä»¥ä¿è¯åˆå§‹åŒºé—´ [mid+1, mid+1) æ˜¯ä¸€ä¸ªç©ºåŒºé—´
    var end = mid + 1;
    for (var i = lo; i <= mid; i++) {
        // nums ä¸­çš„å…ƒç´ å¯èƒ½è¾ƒå¤§ï¼Œä¹˜ 2 å¯èƒ½æº¢å‡ºï¼Œæ‰€ä»¥è½¬åŒ–æˆ long
        while (end <= hi && nums[i] > nums[end]) {
            end++;
        }
        count[0] += end - (mid + 1);
    }

    // æ•°ç»„åŒæŒ‡é’ˆæŠ€å·§ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    var i = lo, j = mid + 1;
    for (var p = lo; p <= hi; p++) {
        if (i == mid + 1) {
            nums[p] = temp[j++];
        } else if (j == hi + 1) {
            nums[p] = temp[i++];
        } else if (temp[i] > temp[j]) {
            nums[p] = temp[j++];
        } else {
            nums[p] = temp[i++];
        }
    }
}
```

</div></div>
</div></div>

</details>
</div>







